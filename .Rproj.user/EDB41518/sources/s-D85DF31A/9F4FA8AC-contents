---
title: "tatoo"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(rms)
library(ResourceSelection)
```

## Read and explore the data set

```{r}
tatooDF <- read.csv("C7 Tatoos.csv")
summary(tatooDF)
```
We will use the table function to see if there are any NAs or any weird characters in our columns. We will also remvove the unnecessary columns.
```{r}
table(tatooDF$method)
table(tatooDF$gender)
table(tatooDF$depth)
table(tatooDF$method)
```

There are no NAs or weird characters except for our 0s and 1s. Let's move forward.

```{r}
tatooDF1 <- tatooDF %>% 
  select(!X) %>%
  select(!X.1) %>%
  select(!gender..1.Male)
```

## Logistic Regression Model
```{r}
reg <- glm(removal ~ ., tatooDF1, family = binomial)
summary(reg)
```
The p-value for gender is not statistically significant, we will try dropping it.
```{r}
reg2 <- glm(removal ~ method + depth, tatooDF1, family = binomial)
summary(reg2)
```
We will also try dropping method because its p-value is not significant.
```{r}
reg3 <- glm(removal ~ method, tatooDF1, family = binomial)
summary(reg3)
```

```{r}
pchisq(76.228-64.575,3,lower.tail = FALSE)
pchisq(76.228-65.002,2,lower.tail = FALSE)
pchisq(76.228-75.242,1,lower.tail = FALSE)

```
All of the models have variables that their p-values are not statistically significant. According to the drop-in deviance statistics, we should choose the second model. The AIC of the second model is also the lowest. 

```{r}
summary(reg2)
exp(0.7051)
exp(1.8415)
```
According to the logistic regression model, we have:
p(X) = $\frac{e^{0.4711+0.7051*method-1.8415*depth}}{1+e^{0.4711+0.7051*method-1.8415*depth}}$

We see that $\beta_1$ = 0.7051; this indicates that a shift from method 0 to method 1 is associated with an increase in the probability of the success of removal. To be precise, a shift from method 0 to method 1 is associated with an increase in the log odds of removal by 0.7051 units. In other words, we estimate that if we shift from method 0 to method 1, the odds of removing successfully go up by 2.02%.

We see that $\beta_2$ = -1.8415; this indicates that a shift from not deep to deep is associated with a decrease in the probability of the success of removal. To be precise, a shift from not deep to deep is associated with a decrease in the log odds of Malignant by 1.8415 units. In other words, we estimate that if it's a concave cancer cell, the odds of removing successfully go down by 6.305%.

Since the p-value for method is statistically significant (<0.05), we can reject $H_0$ that $\beta_1 = 0$. In other words, we conclude that there is indeed an association between method and probability of success of removal. However, the p-value for depth and the intercept is not statistically significant so we may have to look into squaring or interaction terms.

```{r}
pchisq(76.228-65.002,2,lower.tail = FALSE)
```
Our residual deviance (65.002) seems to be slightly lower than our null deviance(76.228). The probability of getting a larger or equal drop-in deviance is also statistically significant (lower than 0.05). This indicates that it's hard to have a larger or equal drop-in deviance. Thus, our model is adequate. It is significantly better than the null model, explaining a larger amount of variation of the success of removal.

## Validate the model
```{r}
tatooDF2 <- tatooDF1 %>%
  mutate(res = resid(reg2), fit = fitted(reg2))

tatooDF2 %>%
  ggplot(aes(res)) + 
  geom_histogram()
```
The residuals seem to be binomially distributed and the histogram is symmetric.

```{r}
hoslem.test(tatooDF2$removal, tatooDF2$fit)
```
Since the p-value is 0.9685 > 0.05, we fail to reject the null hypothesis that the residuals have a binormal distribution.

## Make prediction 
```{r}
confint(reg2, level=0.95)

newDF = data.frame(method = 0, depth = 1)
predict(reg2, newDF, type="response")
```
Given a concave cancer cell with radius of 2.449, it's likely that we can't remove the tatoo. 


