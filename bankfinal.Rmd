---
title: "Bank Telemarketing Analysis"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(rms)
library(ResourceSelection)
library(naniar)
```

### Content

A. Introduction\
B. Problem Statement\
C. Our Data\
D. Modeling Process\
E. Final Thoughts

### A. Introduction

Telemarketing is a method of selling products and services over the phone to customers. It has always been a controversial approach. On one hand, it is easy to directly reach out to customers and also cheaper than other marketing methods. On the other hand, it has bad reputations of damaging the company's image and some of the startup costs are very expensive.\
In this project, we are looking into how other factors can affect the outcome of telemarketing campaigns for a specific institution, Portuguese retail bank, and make prediction based on our model. The main focus of this project is incredibly interesting since we typically feel annoyed by telemarketing.

### B. Problem Statement

Our main question is what is likely to be the outcome of the telemarketing campaigns based on the characteristics of the clients and the calls. Our goal is to predict if the client will subscribe (yes/no) to a term deposit (variable y).\
Note: A term deposit is a type of deposit account held at a financial institution where money is locked up for some set period of time.

### C. Our Data

#### 1. Data Source

• Dataset name: Bank Tele-Marketing Data Set\
• Original Source of the Dataset: $[$Moro et al., 2014$]$ S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014\
• We retrieve the data from UCI Machine Learning Repository. The data is accessible [here](http://archive.ics.uci.edu/ml/datasets/Bank+Marketing).

#### 2. Background

• The data is collected from several telemarketing campaigns in which the Portuguese bank attempted to target customers through phone calls to sell long-term deposits.\
• The dataset includes both the phone calls of which the bank executed and the phone calls of which clients contacted the help center.\
• Each observation includes the outcome, whether or not the target customers subscribed the term deposit, and the characteristics of the customers and the phone calls themselves.

#### 3. Variable Description

This dataset was collected from May 2008 to November 2010 with 41188 observations and 20 variables.

+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| No.   | Variable Name  | Variable Definiton                                                                         | Data Type   | Units/Categories                                                                                                           | Missing Value Codes | Note                                                                                                                                                                  |
+=======+================+============================================================================================+=============+============================================================================================================================+=====================+=======================================================================================================================================================================+
| 1     | age            | Client's age                                                                               | Discrete    | years                                                                                                                      | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 2     | job            | Type of client's job                                                                       | Categorical | admin, blue-collar, entrepreneur, housemaid, management, retired, self-employed, services, student, technician, unemployed | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 3     | marital        | Marital status                                                                             | Categorical | divorced, married, single                                                                                                  | unknown             | 'divorced' means divorced or widowed                                                                                                                                  |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 4     | education      | Education level                                                                            | Categorical | basic.4y, basic.6y, basic.9y, high.school, illiterate, professional.course, university.degree                              | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 5     | default        | Has credit in default?                                                                     | Categorical | yes, no                                                                                                                    | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 6     | housing        | Has housing loan?                                                                          | Categorical | yes, no                                                                                                                    | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 7     | loan           | Has personal loan?                                                                         | Categorical | yes, no                                                                                                                    | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 8     | contact        | Contact communication type                                                                 | Categorical | cellular, telephone                                                                                                        | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 9     | month          | Last contact month of year                                                                 | Categorical | jan, feb, mar, ..., nov, dec                                                                                               | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 10    | day_of_week    | Last contact day of the week                                                               | Categorical | mon, tue, wed, thu, fri                                                                                                    | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 11    | duration       | Last contact duration                                                                      | Discrete    | seconds                                                                                                                    | unknown             | This attribute highly affects the output target (e.g., if duration=0 then y='no'). Yet, the duration is not known before a call is performed.                         |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 12    | campaign       | Number of contacts performed during this campaign and for this client                      | Discrete    | contacts                                                                                                                   | unknown             | including last contact                                                                                                                                                |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 13    | pdays          | Number of days that passed by after the client was last contacted from a previous campaign | Discrete    | days                                                                                                                       | unknown             | 999 means client was not previously contacted                                                                                                                         |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 14    | previous       | Number of contacts performed before this campaign and for this client                      | Discrete    | contacts                                                                                                                   | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 15    | poutcome       | Outcome of the previous marketing campaign                                                 | Categorical | failure, success, nonexistent                                                                                              | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 16    | emp.var.rate   | Employment variation rate - quarterly indicator                                            | Continuous  | \-                                                                                                                         | unknown             | Calculate the variation of employment rate ⇒ higher variation means the employment rate changes a lot (unstable economy)                                              |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 17    | cons.price.idx | Consumer price index - monthly indicator                                                   | Continuous  | \-                                                                                                                         | unknown             | The average change in prices over time that consumers pay for a basket of goods and services                                                                          |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 18    | cons.conf.idx  | Consumer confidence index - monthly indicator                                              | Continuous  | \-                                                                                                                         | unknown             | Defined as the degree of optimism about the state of the economy that consumers are expressing through their activities of saving and spending                        |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 19    | euribor3m      | Euribor 3 month rate - daily indicator                                                     | Continuous  | \-                                                                                                                         | unknown             | Euribor is an overnight interbank rate comprised of the average interest rates from a panel of large European banks that are used for lending to one another in euros |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 20    | nr.employed    | Number of employees - quarterly indicator                                                  | Numeric     | \-                                                                                                                         | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 21    | y              | Has the client subscribed to a term deposit?                                               | Categorical | yes, no                                                                                                                    | unknown             |                                                                                                                                                                       |
+-------+----------------+--------------------------------------------------------------------------------------------+-------------+----------------------------------------------------------------------------------------------------------------------------+---------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+

#### 4. Problems with Data

1.  There are two many categorical variables that aren't Bernoulli variables, and it would be complicated to interpret with too many of them\
    ⇒ Possible solutions: change some of them (month, day_of_week, contact, etc) to other type of variables or group some of the categories together\
2.  Some of the data are not in its correct form (Bernoulli not broken into 0 and 1)\
3.  Some variables are terminologies\
4.  Some variables have many NAs\
5.  Some variables have special cases such as marital, duration, pdays

### D. Working with Data

```{r include = FALSE}
bankDf <- read.csv2("bank-additional-full.csv")
summary(bankDf)
glimpse(bankDf)
```

#### 1. Data Wrangling

Turn all "unknown" to NA value

```{r}
bankDf <- bankDf %>% replace_with_na_all(condition = ~.x == "unknown")
```

Turn Bernoulli variables into 0 and 1 categories

```{r}
bankDf <- rename(bankDf, telephone = contact)
bankDf <- rename(bankDf, deposit = y)

bankDf <- bankDf %>%
  mutate(default = ifelse(default == "yes", 1, 0)) %>%
  mutate(housing = ifelse(housing == "yes", 1, 0)) %>%
  mutate(loan = ifelse(loan == "yes", 1, 0)) %>%
  mutate(telephone = ifelse(telephone == "telephone", 1, 0)) %>%
  mutate(deposit = ifelse(deposit == "yes", 1, 0))
```

Turn other variables into its suitable types of variables

```{r}
bankDf$job <- as.factor(bankDf$job)
bankDf$marital <- as.factor(bankDf$marital)
bankDf$education <- as.factor(bankDf$education)
bankDf$default <- as.factor(bankDf$default)
bankDf$housing <- as.factor(bankDf$housing)
bankDf$loan <- as.factor(bankDf$loan)
bankDf$telephone <- as.factor(bankDf$telephone)
bankDf$poutcome <- as.factor(bankDf$poutcome)
bankDf$month <- as.factor(bankDf$month)
bankDf$day_of_week <- as.factor(bankDf$day_of_week)

bankDf$previous <- as.numeric(bankDf$previous)
bankDf$emp.var.rate <- as.numeric(bankDf$emp.var.rate)
bankDf$cons.price.idx <- as.numeric(bankDf$cons.price.idx)
bankDf$cons.conf.idx <- as.numeric(bankDf$cons.conf.idx)
bankDf$euribor3m <- as.numeric(bankDf$euribor3m)
bankDf$nr.employed <- as.numeric(bankDf$nr.employed)

bankDf$pdays <- as.factor(bankDf$pdays)
```

#### 2. Data Exploration

```{r}
summary(bankDf)
```

After taking a look at the summary of the dataset, we decide to remove those columns below:\
- `default` because it has too many NAs\
- `poutcome` (previous campaign's outcome) because it has too many "nonexistent" result\
- `pdays` (days after the customers were last contacted in the previous campaigns) because most of the customers had never been contacted before

```{r}
bankDf <- bankDf %>%
  select(!default) %>%
  select(!poutcome) %>%
  select(!pdays)

bankDf <- na.omit(bankDf)
summary(bankDf)
```

Split into traning and test dataset with 80% data used for training and 20% for test

```{r}
set.seed(1)
N <- seq(38245)
S <- sample(N,30596)
bankTrain <- bankDf[S,]
bankTest <- bankDf[-S,]
summary(bankTrain)
summary(bankTest)
```

Looking at the summary table, a histogram of `age`, `duration`, `campaign`, `previous` may be worth looking at since the data seems to be skewed and needs some transformation.

```{r}
bankTrain %>%
  ggplot(aes(age)) + geom_histogram() +
  labs(title = "Histogram of age")

bankTrain %>%
  ggplot(aes(duration)) + geom_histogram() +
  labs(title = "Histogram of duration")

bankTrain %>%
  ggplot(aes(campaign)) + geom_histogram() +
  labs(title = "Histogram of campaign")

bankTrain %>%
  ggplot(aes(previous)) + geom_histogram() +
  labs(title = "Histogram of previous")
table(bankTrain$previous)
```

We will use log transformation on `duration` and `campaign`. We will also turn `previous` into a categorical variable.

```{r}
#log transformation
bankTrain <- bankTrain %>%
  mutate(logDuration = log(duration))

bankTrain <- bankTrain %>%
  mutate(logCampaign = log(campaign))

bankTrain %>%
  ggplot(aes(logDuration)) + geom_histogram() +
  labs(title = "Histogram of logDuration")

bankTrain %>%
  ggplot(aes(logCampaign)) + geom_histogram() +
  labs(title = "Histogram of logCampaign")
```

`campaign` seems to be worsened off so we may leave it alone instead of taking the log transformation.

```{r}
bankTrain <- bankTrain %>%
  select(!logCampaign) %>%
  select(!duration)
```

We will draw some more plots to see which categorical variables potentially have influence on `deposit`.

```{r}
bankTrain %>% 
  ggplot(aes(x = job, fill = deposit)) + geom_bar() + labs(title = "Distribution of deposit based on job") + theme(axis.text.x = element_text(angle = 10))

bankTrain %>% 
  ggplot(aes(x = job, fill = deposit)) + geom_bar() + labs(title = "Distribution of deposit based on job") + theme(axis.text.x = element_text(angle = 10))
```

### E. Modeling process

#### 1. Initial Modeling

```{r}
bankTrain <- bankTrain %>%
  filter(logDuration != -Inf)

reg <- glm(deposit ~ ., bankTrain, family = binomial)
summary(reg)
```

We would remove `age`, `job`, `marital`, `education`, `housing`, `loan`, `day_of_week`, `campaign`, `nr.employed`

```{r}
reg2 <- glm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration, bankTrain, family = binomial)
summary(reg2)
lrm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration, bankTrain)
```

We may consider remove `month`

```{r}
reg3 <- glm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + euribor3m + cons.conf.idx + logDuration, bankTrain, family = binomial)
summary(reg3)
lrm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + euribor3m + cons.conf.idx + logDuration, bankTrain)
```

Also, remove `euribor3m`.

```{r}
reg4 <- glm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + cons.conf.idx + logDuration, bankTrain, family = binomial)
summary(reg4)
lrm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + cons.conf.idx + logDuration, bankTrain)
```

Drop-in deviance tests

```{r}
pchisq(21272-12182,43,lower.tail = FALSE)
pchisq(21272-12267,16,lower.tail = FALSE)
pchisq(21272-12803,7,lower.tail = FALSE)
pchisq(21272-12803,6,lower.tail = FALSE)

```

We will have to now consider moving forward with one of the models. We should definitely eliminate model 1 as it has too many varriables with statistically insignificant p-values. We should also eliminate model 3 because `euribor3m` has a statistically insignificant p-values. We are left with model 2 and 4. The drop-in deviance tests yield 0 for all models, indicating that the probability of getting a larger or equal drop-in deviance is also statistically significant (lower than 0.05). This indicates that it's hard to have a larger or equal drop-in deviance. Thus, our models are adequate. They are significantly better than the null model, explaining a larger amount of variation of `deposit`.

Since the drop-in deviance test doesn't point out which model is better, we will take a look at the residual deviance and Dxy.

```{r}
lrm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration, bankTrain)
lrm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + cons.conf.idx + logDuration, bankTrain)
```

Clearly, model 2 has a smaller residual deviance (12267) compared to model 4 (12803). Model 2 also has a larger Dxy than model 4, 0.866 compared to 0.843. This means that model 2 fits the data more than model 4, and the variables in model 2 are more significant.\
The only concern we have is that some of the month is not significant. We may convert month into different Bernoulli variables and eliminate those that are not significant or we may run a drop-in deviance test for month to see if it offers a greater model than the null model.

```{r}
pchisq(12803-12267,16-7,lower.tail = FALSE)
```

It appears that month is quite significant since the drop-in test yields 1.11\*10\^{-109} as the p-value. After some experiment, we realize that using august as the baseline would make all the p-values significant. This can happen due to the fact that the `monthaug` may affect `deposit` different from other months a lot.

```{r}
bankTrain$month <- relevel(bankTrain$month, ref = "aug")
reg5 <- glm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration, bankTrain, family = binomial)
summary(reg5)
lrm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration, bankTrain)
```

We will move forward with model 2 and try to improve the model by adding interaction terms.

#### 2. Adding Interaction Terms

Since when we remove month, euribor3m is also affected a lot, we will try an interaction term between month and euribor3m.

```{r}
bankTrain %>% 
  ggplot(aes(euribor3m, deposit)) + geom_point() +
  stat_smooth(method = "glm",method.args = list(family= "binomial")) +
  facet_wrap(~month) +
  labs(title = "Relationship between euribor3m and deposit based on month")
```

```{r}
reg6 <- glm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration + month*euribor3m, bankTrain, family = binomial)
summary(reg6)

lrm(deposit ~ telephone + month + previous + emp.var.rate + cons.price.idx + cons.conf.idx + euribor3m + logDuration + month*euribor3m + campaign, bankTrain, maxit=1000)
```

Most p-values are statistically significant (\< 0.05), and Dxy increases from 0.866 to 0.872 so we would move forward with this model.

#### 3. Adding variables

Looking back at the first model, we realize that higher education (professional.course and university.degree) is actually quite significant. We would try to create a dummy variable for higher education.

```{r}
table(bankTrain$education)

bankTrain <- bankTrain %>%
  mutate(higherEd = ifelse(education == "professional.course" | education == "university.degree", 1 ,0))

reg6 <- glm(deposit ~ telephone + previous + emp.var.rate + cons.price.idx + cons.conf.idx + logDuration + month*euribor3m + higherEd, bankTrain, family = binomial)
summary(reg6)

lrm(deposit ~ telephone  + previous + emp.var.rate + cons.price.idx + cons.conf.idx + logDuration + month*euribor3m + higherEd, bankTrain, maxit = 1000)

```

Most p-values are statistically significant (lower than 0.05), and Dxy increases from 0.872 to 0.873 so we will decide on using this model.

### F. Interpretation:

According to the logistic regression model, we have:\
- When all variables equal 0 and it's August, the log odds of deposit is -192.5782, and the probability of the customer subscribing to the term deposit is 3.54\*10\^(-84), indicating that the customer will not deposit.\
- telephone: A shift from using cell phone to telephone is associated with a decrease in the log odds of deposit by 0.4998 units, indicating that if the call method is telephone instead of cell phone, the odds of getting the customers to deposit go down by 1.65 times (or 165%). This makes sense as the dataset also include calls of which customers contact the help center. There will be people who need help and will be frustrated if they don't get what they need immediately but some introduction to a term deposit that they don't care about instead. Using cellphone will also create a sense of personal relationship between the caller and the customer instead of a sense of being a part of just a telemarketing campaign.\
- previous: When previous increases by 1, the log odds of deposit increases by 0.16 units, indicating that the odds of successfully having customers deposit go up by 1.17 times (or 117%). As mention aboved in the variable description, previous means number of contacts performed before this campaign and for this client so the more contacts are performed before, the more experience and familiarity the telemarketing team will possess and hence will persuade the customers better.\
- emp.var.rate: When emp.var.rate increases by 1, the log odds of deposit decreases by -1.5057 units, indicating that the odds of successfully having customers deposit go down by 4.51 times (or 451%).emp.var.rate measures the variation of employment rate. High emp.var.rate indicates an unstable economy.\
- cons.price.idx: When cons.price.idx increases by 1, the log odds of deposit increases by 1.92 units, indicating that the odds of sucessfully having customers deposit go up by 6.82 times (or 682%). Higher cons.price.idx means higher inflation rate -> higher nominal interest rate so it makes sense that the higher the cons.price.idx, the higher chance the customers want to subscribe to a term deposit.\
- cons.conf.idx: When cons.conf.idx increases by 1, the log odds of deposit increases by 0.0766 units, indicating that the odds of successfully having customers deposit go up by 1.08 times (or 108%). It makes sense that the higher the consumer confidence level is, the higher chance they want to subscribe to a term deposit.\
- euribor3m: When euribo3m increases by 1, the log odds of deposit increases by 0.4183 units, indicating that the odds of successfully having customers deposit go up by 1.52 times (or 152%). euribor3m is the average interest rates from a panel of large European banks that are used for lending to one another.\
- logDuration: When logDuration increases by 1, the log odds of deposit increases by 2.2783 units, indicating that the odds of successfully having customers deposit go up by 9.76 times (or 976%). This makes sense since normally, if customers receive a call that they don't care about, they will try to end the call as soon as possible. Longer duration also indicates that the company has more time to persuade the customer to subscribe to the term deposit.\
- higherEd: A shift from having high education level to not having high education level is associated with an increase in the log odds of deposit by 0.1904 units, indicating that if the customer has university degree or professional courses, the odds of getting the customers to deposit go up by 1.21 times (or 121%).\
- month: Of all the months, December, September and October are associated with a decrease in the log odds of deposit. This might indicate that customers tend to keep money by themselves or use it at the end of the year.\
- C is 0.936. This indicates that 93.6% of pairs of 0 and 1 fit the model (0.5->1 - random guessing).\
- Dxy is 0.873. This is a rescale of C to make it range from 0 to 1 instead of 0.5 to 1. 0.873 is still a good number. This model explains about 87.3% of our data.

### G. Model Validation

#### Drop-in deviance test

```{r}
pchisq(21272 - 12016, 27, lower.tail = FALSE)
```

The drop-in deviance tests yield 0, indicating that the probability of getting a larger or equal drop-in deviance is also statistically significant (lower than 0.05). This indicates that it's hard to have a larger or equal drop-in deviance. Thus, our model is adequate. This is significantly better than the null model, explaining a larger amount of variation of `deposit`.

#### Check for binormiality and normal distribution

```{r}
bankTrain2 <- bankTrain %>%
  mutate(res = resid(reg6), fit = fitted(reg6))
bankTrain2 %>% ggplot(aes(res)) + geom_histogram() + labs(title = "Histogram of residuals")
```

The histogram of residual is unbalanced. This may be due to the unbalanced dataset that we have (more 'no' than 'yes' for `deposit`). However, the distribution still centers at 0 so this is still acceptable. We will also run the Hosmer-Lem test to check for binormiality.

```{r}
hoslem.test(bankTrain2$deposit, bankTrain2$fit,g=3000)
```

We change the number of bins to 3000 to fit the size of the dataset. The p-value is 0.9159. It is not statistically significant (higher than 0.05) so we fail to reject the null hypothesis that the residuals have a binormal distribution.

### H. Prediction

We will start with predicting 3 random observations from the test set.

```{r}
bankTest2 <- bankTest %>%
  mutate(logDuration = log(duration)) %>%
  mutate(higherEd = ifelse(education == "professional.course" | education == "university.degree", 1 ,0)) %>%
  filter(logDuration != -Inf)

set.seed(4)
N <- seq(7649)
random <- sample(N, 3)
bankTestPt <- bankTest2[random, ]

bankTestPt <- bankTestPt %>%
  mutate(result = 0)
bankTestPt[1, 'result'] <- predict(reg6, bankTestPt[1,], type = "response")
bankTestPt[2, 'result'] <- predict(reg6, bankTestPt[2,], type = "response")
bankTestPt[3, 'result'] <- predict(reg6, bankTestPt[3,], type = "response")
bankTestPt %>%
  dplyr::select(deposit, result)
```

The result when the actual deposit is 1 is quite higher than the results when the actual deposits are 0 but still not high enough. We will make some calculations (Recall, Precision, and Accuracy) to better assess the result.

```{r}
bankTest3 <- bankTest2 %>%
  mutate(predict = predict(reg6, bankTest2, type = "response")) %>%
  mutate(predictDeposit = ifelse(predict < 0.5,0,1))

N <- seq(nrow(bankTest3))

for (i in N) {
  if ((bankTest3[i,'predictDeposit'] == 0) && (bankTest3[i, 'deposit'] == 1)) {
    bankTest3[i,'result'] = "FN"
  }
  else if ((bankTest3[i,'predictDeposit'] == 1) && (bankTest3[i, 'deposit'] == 1)) {
    bankTest3[i,'result'] = "TP"
  }
  else if ((bankTest3[i,'predictDeposit'] == 1) && (bankTest3[i, 'deposit'] == 0)) {
    bankTest3[i,'result'] = "FP"
  }
  else {
    bankTest3[i,'result'] = "TN"
  }
}

FN <- sum(bankTest3$result == "FN")
FP <- sum(bankTest3$result == "FP")
TN <- sum(bankTest3$result == "TN")
TP <- sum(bankTest3$result == "TP")
recall <- TP/(TP + FN)
precision <- TP/(TP + FP)
accuracy <- (TP + TN)/(FP + FN + TP + TN)

recall
precision
accuracy
```

-   Recall: From all the customers subscribe to the term deposit, we predict 43.8% of them.\
-   Precision: From all the customers we predict that they subscribe, 67.4% of them actually do.\
-   Accuracy: From all predictions, 91.14% is correct.

### I. Final Thoughts

#### 1. Some suggestions to the bank in Portugal

\- Bank should look at the economy of the country before launching a telemarketing campaign

\- They should also train their telemarketing team to handle different type of calls appropriately

\- Avoid the end of the year for telemarketing campaigns

\- They might also aim their campaign at customers who have higher education levels

#### 2. Future work

\- We have an unbalanced dataset => oversampling undersampling methods to get more reliable results

\- Analyze whether or not we can apply this model to other similiar-size banks in Portugal
